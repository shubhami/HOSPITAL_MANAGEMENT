# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'C:\Users\admin\Desktop\Python Programs\QT5\Hospital Management\hospital.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5.QtWidgets import *
from PyQt5.QtGui import *
from PyQt5 import QtWidgets
from PyQt5.QtCore import *
from PyQt5 import QtCore
from PyQt5.QtWidgets import QMainWindow
from PyQt5.QtWidgets import QApplication
import pandas as pd
import sqlite3
import xlsxwriter
import sys

class Ui_Form(object):
    def setupUi(self, Form):
        Form.setObjectName("Form")
        Form.resize(1266, 854)
        self.extract = QtWidgets.QPushButton(Form)
        self.extract.setGeometry(QtCore.QRect(680, 770, 161, 41))
        font = QtGui.QFont()
        font.setFamily("Calibri")
        font.setPointSize(14)
        self.extract.setFont(font)
        self.extract.setObjectName("extract")
        self.refreshbtn = QtWidgets.QPushButton(Form)
        self.refreshbtn.setGeometry(QtCore.QRect(920, 770, 171, 41))
        font = QtGui.QFont()
        font.setFamily("Calibri")
        font.setPointSize(14)
        self.refreshbtn.setFont(font)
        self.refreshbtn.setObjectName("refreshbtn")
        self.tabWidget_2 = QtWidgets.QTabWidget(Form)
        self.tabWidget_2.setGeometry(QtCore.QRect(70, 100, 1121, 671))
        font = QtGui.QFont()
        font.setFamily("Calibri")
        font.setPointSize(15)
        self.tabWidget_2.setFont(font)
        self.tabWidget_2.setObjectName("tabWidget_2")
        self.tab_4 = QtWidgets.QWidget()
        self.tab_4.setObjectName("tab_4")
        self.table = QtWidgets.QTableWidget(self.tab_4)
        self.table.setGeometry(QtCore.QRect(0, 0, 1111, 621))
        self.table.setMinimumSize(QtCore.QSize(1111, 0))
        self.table.setMaximumSize(QtCore.QSize(1111, 621))
        font = QtGui.QFont()
        font.setFamily("Calibri")
        font.setPointSize(10)
        self.table.setFont(font)
        self.table.setLineWidth(1)
        self.table.setMidLineWidth(0)
        self.table.setObjectName("table")
        self.table.setColumnCount(11)
        self.table.setRowCount(0)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(0, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(1, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(2, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(3, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(4, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(5, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(6, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(7, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(8, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(9, item)
        item = QtWidgets.QTableWidgetItem()
        self.table.setHorizontalHeaderItem(10, item)
        self.tabWidget_2.addTab(self.tab_4, "")
        self.tab_5 = QtWidgets.QWidget()
        self.tab_5.setObjectName("tab_5")
        self.label_7 = QtWidgets.QLabel(self.tab_5)
        self.label_7.setGeometry(QtCore.QRect(10, 30, 181, 41))
        self.label_7.setObjectName("label_7")
        self.label_8 = QtWidgets.QLabel(self.tab_5)
        self.label_8.setGeometry(QtCore.QRect(10, 110, 121, 31))
        self.label_8.setObjectName("label_8")
        self.label_9 = QtWidgets.QLabel(self.tab_5)
        self.label_9.setGeometry(QtCore.QRect(20, 180, 101, 31))
        self.label_9.setObjectName("label_9")
        self.label_10 = QtWidgets.QLabel(self.tab_5)
        self.label_10.setGeometry(QtCore.QRect(20, 250, 101, 31))
        self.label_10.setObjectName("label_10")
        self.label_11 = QtWidgets.QLabel(self.tab_5)
        self.label_11.setGeometry(QtCore.QRect(500, 40, 121, 31))
        self.label_11.setObjectName("label_11")
        self.label_12 = QtWidgets.QLabel(self.tab_5)
        self.label_12.setGeometry(QtCore.QRect(20, 330, 141, 31))
        self.label_12.setObjectName("label_12")
        self.fname = QtWidgets.QLineEdit(self.tab_5)
        self.fname.setGeometry(QtCore.QRect(210, 40, 171, 31))
        self.fname.setObjectName("fname")
        self.lname = QtWidgets.QLineEdit(self.tab_5)
        self.lname.setGeometry(QtCore.QRect(210, 110, 171, 31))
        self.lname.setObjectName("lname")
        self.gender = QtWidgets.QLineEdit(self.tab_5)
        self.gender.setGeometry(QtCore.QRect(210, 180, 171, 31))
        self.gender.setObjectName("gender")
        self.bgroup = QtWidgets.QLineEdit(self.tab_5)
        self.bgroup.setGeometry(QtCore.QRect(210, 330, 171, 31))
        self.bgroup.setObjectName("bgroup")
        self.cno = QtWidgets.QLineEdit(self.tab_5)
        self.cno.setGeometry(QtCore.QRect(750, 40, 171, 31))
        self.cno.setText("")
        self.cno.setObjectName("cno")
        self.label_19 = QtWidgets.QLabel(self.tab_5)
        self.label_19.setGeometry(QtCore.QRect(500, 110, 121, 31))
        self.label_19.setObjectName("label_19")
        self.label_21 = QtWidgets.QLabel(self.tab_5)
        self.label_21.setGeometry(QtCore.QRect(500, 190, 121, 31))
        self.label_21.setObjectName("label_21")
        self.label_22 = QtWidgets.QLabel(self.tab_5)
        self.label_22.setGeometry(QtCore.QRect(500, 320, 121, 31))
        self.label_22.setObjectName("label_22")
        self.mail = QtWidgets.QLineEdit(self.tab_5)
        self.mail.setGeometry(QtCore.QRect(750, 110, 171, 31))
        self.mail.setObjectName("mail")
        self.doctor = QtWidgets.QLineEdit(self.tab_5)
        self.doctor.setGeometry(QtCore.QRect(750, 320, 171, 31))
        self.doctor.setObjectName("doctor")
        self.date = QtWidgets.QDateEdit(self.tab_5)
        self.date.setGeometry(QtCore.QRect(750, 180, 171, 31))
        self.date.setObjectName("date")
        self.addbtn = QtWidgets.QPushButton(self.tab_5)
        self.addbtn.setGeometry(QtCore.QRect(710, 480, 231, 51))
        self.addbtn.setObjectName("addbtn")
        self.label = QtWidgets.QLabel(self.tab_5)
        self.label.setGeometry(QtCore.QRect(500, 250, 211, 31))
        self.label.setObjectName("label")
        self.disease = QtWidgets.QLineEdit(self.tab_5)
        self.disease.setGeometry(QtCore.QRect(750, 250, 251, 31))
        self.disease.setObjectName("disease")
        self.age = QtWidgets.QSpinBox(self.tab_5)
        self.age.setGeometry(QtCore.QRect(210, 240, 161, 31))
        self.age.setObjectName("age")
        self.tabWidget_2.addTab(self.tab_5, "")
        self.tab_6 = QtWidgets.QWidget()
        self.tab_6.setObjectName("tab_6")
        self.table2 = QtWidgets.QTableWidget(self.tab_6)
        self.table2.setGeometry(QtCore.QRect(0, 110, 1111, 511))
        self.table2.setMinimumSize(QtCore.QSize(1111, 0))
        self.table2.setMaximumSize(QtCore.QSize(1111, 621))
        font = QtGui.QFont()
        font.setFamily("Calibri")
        font.setPointSize(10)
        self.table2.setFont(font)
        self.table2.setLineWidth(1)
        self.table2.setMidLineWidth(0)
        self.table2.setObjectName("table2")
        self.table2.setColumnCount(11)
        self.table2.setRowCount(0)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(0, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(1, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(2, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(3, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(4, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(5, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(6, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(7, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(8, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(9, item)
        item = QtWidgets.QTableWidgetItem()
        self.table2.setHorizontalHeaderItem(10, item)
        self.select = QtWidgets.QComboBox(self.tab_6)
        self.select.setGeometry(QtCore.QRect(50, 30, 331, 31))
        self.select.setObjectName("select")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.select.addItem("")
        self.searchbtn = QtWidgets.QPushButton(self.tab_6)
        self.searchbtn.setGeometry(QtCore.QRect(910, 30, 161, 31))
        self.searchbtn.setObjectName("searchbtn")
        self.value = QtWidgets.QLineEdit(self.tab_6)
        self.value.setGeometry(QtCore.QRect(460, 30, 321, 31))
        self.value.setObjectName("value")
        self.tabWidget_2.addTab(self.tab_6, "")

        self.retranslateUi(Form)
        self.tabWidget_2.setCurrentIndex(0)
        QtCore.QMetaObject.connectSlotsByName(Form)

        #ADDING THE HADNLE_BUTTON EVENT FUNCTION
        self.Handle_Buttons()

    def retranslateUi(self, Form):
        _translate = QtCore.QCoreApplication.translate
        Form.setWindowTitle(_translate("Form", "Form"))
        self.extract.setText(_translate("Form", "Extract Data"))
        self.refreshbtn.setText(_translate("Form", "Refresh"))
        item = self.table.horizontalHeaderItem(0)
        item.setText(_translate("Form", "ID"))
        item = self.table.horizontalHeaderItem(1)
        item.setText(_translate("Form", "First Name"))
        item = self.table.horizontalHeaderItem(2)
        item.setText(_translate("Form", "Last Name"))
        item = self.table.horizontalHeaderItem(3)
        item.setText(_translate("Form", "Gender"))
        item = self.table.horizontalHeaderItem(4)
        item.setText(_translate("Form", "Age"))
        item = self.table.horizontalHeaderItem(5)
        item.setText(_translate("Form", "Blood Group"))
        item = self.table.horizontalHeaderItem(6)
        item.setText(_translate("Form", "Contact No"))
        item = self.table.horizontalHeaderItem(7)
        item.setText(_translate("Form", "Mail"))
        item = self.table.horizontalHeaderItem(8)
        item.setText(_translate("Form", "Date"))
        item = self.table.horizontalHeaderItem(9)
        item.setText(_translate("Form", "Disease/Symptoms"))
        item = self.table.horizontalHeaderItem(10)
        item.setText(_translate("Form", "Doctor"))
        self.tabWidget_2.setTabText(self.tabWidget_2.indexOf(self.tab_4), _translate("Form", "Patient Details"))
        self.label_7.setText(_translate("Form", "First Name"))
        self.label_8.setText(_translate("Form", "Last Name"))
        self.label_9.setText(_translate("Form", "Gender"))
        self.label_10.setText(_translate("Form", "Age"))
        self.label_11.setText(_translate("Form", "Contact No"))
        self.label_12.setText(_translate("Form", "Blood Group"))
        self.label_19.setText(_translate("Form", "Mail"))
        self.label_21.setText(_translate("Form", "Date"))
        self.label_22.setText(_translate("Form", "Doctor"))
        self.addbtn.setText(_translate("Form", "ADD NEW PATIENT"))
        self.label.setText(_translate("Form", "Disease/Symptoms"))
        self.tabWidget_2.setTabText(self.tabWidget_2.indexOf(self.tab_5), _translate("Form", "Add Info"))
        item = self.table2.horizontalHeaderItem(0)
        item.setText(_translate("Form", "ID"))
        item = self.table2.horizontalHeaderItem(1)
        item.setText(_translate("Form", "First Name"))
        item = self.table2.horizontalHeaderItem(2)
        item.setText(_translate("Form", "Last Name"))
        item = self.table2.horizontalHeaderItem(3)
        item.setText(_translate("Form", "Gender"))
        item = self.table2.horizontalHeaderItem(4)
        item.setText(_translate("Form", "Age"))
        item = self.table2.horizontalHeaderItem(5)
        item.setText(_translate("Form", "Blood Group"))
        item = self.table2.horizontalHeaderItem(6)
        item.setText(_translate("Form", "Contact No"))
        item = self.table2.horizontalHeaderItem(7)
        item.setText(_translate("Form", "Mail"))
        item = self.table2.horizontalHeaderItem(8)
        item.setText(_translate("Form", "Date"))
        item = self.table2.horizontalHeaderItem(9)
        item.setText(_translate("Form", "Disease/Symptoms"))
        item = self.table2.horizontalHeaderItem(10)
        item.setText(_translate("Form", "Doctor"))
        self.select.setItemText(0, _translate("Form", "ID"))
        self.select.setItemText(1, _translate("Form", "First Name"))
        self.select.setItemText(2, _translate("Form", "Last Name"))
        self.select.setItemText(3, _translate("Form", "Gender"))
        self.select.setItemText(4, _translate("Form", "Age"))
        self.select.setItemText(5, _translate("Form", "Blood Group"))
        self.select.setItemText(6, _translate("Form", "Contact No"))
        self.select.setItemText(7, _translate("Form", "Mail"))
        self.select.setItemText(8, _translate("Form", "Date"))
        self.select.setItemText(9, _translate("Form", "Disease/Symptoms"))
        self.select.setItemText(10, _translate("Form", "Doctor"))
        self.searchbtn.setText(_translate("Form", "SEARCH"))
        self.tabWidget_2.setTabText(self.tabWidget_2.indexOf(self.tab_6), _translate("Form", "Search"))


    def Handle_Buttons(self):
        self.refreshbtn.clicked.connect(self.GET_DATA)
        self.addbtn.clicked.connect(self.ADD)
        self.extract.clicked.connect(self.CONVERT)
        self.searchbtn.clicked.connect(self.SEARCH)

    def GET_DATA(self):
        db=sqlite3.connect("patient_record.db")
        #db=sqlite3.connect("parts.db")
        cursor=db.cursor()

        command = ''' SELECT * from details '''
        #command=''' SELECT * from parts_table '''
        #print("Before command execution")
        result=cursor.execute(command)
        #print(str(enumerate(result)))
        self.table.setRowCount(0)

        #print("After command execution")
        for row_number, row_data in enumerate(result):
            self.table.insertRow(row_number)
            #print("In loop 1")
            for column_number, data in enumerate(row_data):
                #print("In loop 2")
                #print(str(data))
                self.table.setItem(row_number, column_number, QTableWidgetItem(str(data)))
                #print("In loop 2")
        #print("After command execution")


    def ADD(self):

        db=sqlite3.connect("patient_record.db")
        cursor=db.cursor()
        print("Check 1")
        firstname=self.fname.text()
        print("Check 1")
        lastname=self.lname.text()
        print("Check 1")
        gender=self.gender.text()
        print("Check 1")
        age=self.age.value()
        print("Check 1")
        blood=self.bgroup.text()
        print("Check 1")
        contact=self.cno.text()
        print("Check 1")
        mail=self.mail.text()
        print("Check 1")
        #date_val=str(self.date.date())
        date_val=str(self.date.date().toPyDate())
        print(date_val)
        print("Check 1")
        disease=self.disease.text()
        print("Check 1")
        doctor=self.doctor.text()
        print("Check 1")
        row=(firstname,lastname,gender,age,blood,contact,mail,date_val,disease,doctor)
        print("check2")

        command = ''' INSERT INTO details ("First Name","Last Name",Gender,Age,"Blood Group","Contact No",Mail,Date,"Disease/Symptoms",Doctor)VALUES(?,?,?,?,?,?,?,?,?,?)'''
        print("check3")
        cursor.execute(command,row)
        print("check4")
        db.commit()


    def CONVERT(self):

        filePath='Data.xlsx'
        conn=sqlite3.connect('parts.db')
        writer=pd.ExcelWriter(filePath,engine='xlsxwriter')
        df=pd.read_sql("select * from parts_table",conn)
        df.to_excel(writer,sheet_name="sheet1",index=False)
        writer.save()

#Search is currently working for only ID this needs to be checked
    def SEARCH(self):
        db=sqlite3.connect("patient_record.db")
        cursor=db.cursor()
        field = self.select.currentText()
        print(field)
        val=self.value.text()
        print(val)
        command=''' SELECT * from details WHERE ? = ? '''
        #cursor.execute("SELECT * FROM PacketManager WHERE {} = ?".format(filters[0]), (parameters[0],))
        #command=''' SELECT * from details WHERE ID = 1 '''
        row=(field,val)
        #result=cursor.execute(command)
        #result=cursor.execute(command,row)
        result=cursor.execute("SELECT * FROM details WHERE {} = ?".format(field), (val,))
        print("execute done")
        print(result)
        print(enumerate(result))
        self.table2.setRowCount(0)
        print("rowcount0")
        
        
	
        for row_number,row_data in enumerate(result):
            self.table2.insertRow(row_number)
            print(row_number)
            print(row_data)
            print("loop1")
            for column_number, data in enumerate(row_data):
                print(column_number)
                print(data)
                print("loop2")
                self.table2.setItem(row_number,column_number,QTableWidgetItem(str(data)))
 



if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    Form = QtWidgets.QWidget()
    ui = Ui_Form()
    ui.setupUi(Form)
    Form.show()
    sys.exit(app.exec_())
